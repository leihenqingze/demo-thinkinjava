# 第6章 访问权限控制

** 访问控制（或隐藏具体实现）与“最初的实现并不恰当”有关。**

所有优秀的作者，包括那些编写软件的程序员，都清楚其著作的**某些部分直至重新创作的时候才变得完美，有时甚至要反复重写多次**。如果你把一个代码段放到了某个位置，等过一会儿回头再看时，有可能会发现有更好的方式去实现相同的功能。这正是重构的原动力之一，**重构即重写代码，以使得它更可读、更易理解，并因此而更具可维护性。**

> 偶尔会有某些人对重构报有异议，他们认为这些代码工作得极好，重构它们无异于浪费时间。这种思维方式的问题在于对于项目所需的时间和资金来说，最大的部分并非投入到了最初的代码编写上，而是投入到了代码的维护上。因此，使代码更加易于理解就意味着节省了大量的金钱。

但是，在这种修改和完善代码的愿望之下，也存在着巨大的压力。通常总是会有一些消费者（客户端程序员）需要你的代码在某些方面保持不变。因此你想改变代码，而他们却想让代码保持不变。由此而产生了在面向对象设计中需要考虑的一个基本问题：**“如何把变动的事物与保持不变的事物区分开来”。**

这对类库(library)而言尤为重要。该类库的消费者必须依赖他所使用的那部分类库，并且能够知道如果类库出现了新版本，他们并不需要改写代码。从另一个方面来说，**类库的开发者必须有权限进行修改和改进，并确保客户代码不会因为这些改动而受到影响。**

这一目标可以通过约定来达到。例如，**类库开发者必须同意在改动类库中的类时不得删除任何现有方法，因为那样会破坏客户端程序员的代码**。但是，与之相反的情况会更加棘手。在有域（即数据成员）存在的情况下，类库开发者要怎样才能知道究竟都有哪些域已经被客户端程序员所调用了呢？这对于方法仅为类的实现的一部分，因此并不想让客户端程序员直接使用的情况来说同样如此。如果程序开发者想要移除旧的实现而要添加新的实现时，结果将会怎样呢？改动任何一个成员都有可能破坏客户端程序员的代码。于是类库开发者会手脚被缚，无法对任何事物进行改动。

为了解决这一问题，Java提供了访问权限修饰词，以供类库开发人员向客户端程序员指明哪些是可用的，哪些是不可用的。访问权限控制的等级，从最大权限到最小权限依次为：public、protected、包访问权限（没有关键词）和private。根据前述内容，读者可能会认为，**作为一名类库设计员，你会尽可能将一切方法都定为private，而仅向客户端程序员公开你愿意让他们使用的方法**。这样做是完全正确的，尽管对于那些经常使用别的语言（特别是C语言）编写程序并在访问事物时不受任何限制的人而言，这与他们的直觉相违背。到了本章末，读者将会信服Java的访问权限控制的价值。

不过，构件类库的概念以及对于谁有权取用该类库构件的控制问题都还是不完善的。**其中仍旧存在着如何将构件捆绑到一个内聚的类库单元中的问题。对于这一点，Java用关键字package加以控制，而访问权限修饰词会因类是存在于一个相同的包，还是存在于一个单独的包而受到影响。**为此，要开始学习本章，首先要学习如何将类库构件置于包中，然后就会理解访问权限修饰词的全部含义。

为了改善代码质量提高系统的可维护性，减少维护的成本或使用更高效的实现方式，我们需要对代码进行重构。为了在不修改客户端代码的情况下，改变服务端的代码。需要对代码的访问权限进行控制，Java中通过访问权限关键字和包管理机制来对代码的访问权限进行控制。

这其中体现了封装的思想。